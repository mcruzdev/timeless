<p-toast position="top-right" />

<div class="flex flex-row gap-2 items-center my-2">
  <h2 class="font-semibold text-2xl">Overview</h2>
  <div class="flex flex-row gap-2 w-full items-center">
    <p-button
      [icon]="eyes() ? 'pi pi-eye-slash' : 'pi pi-eye'"
      (click)="changeEyes()"
      [text]="true"
      rounded="true"
    />
  </div>
</div>

<div class="flex flex-col md:flex-row gap-2">
  <p-card styleClass="p-2 min-w-[200px] h-[100px]">
    <ng-template #header>
      <p class="font-extralight">Saldo</p>
    </ng-template>

    @if (eyes()) {
      <p class="flex-1 text-base font-semibold text-left">
        {{ balance() | currency: "BRL" }}
      </p>
    } @else {
      <p class="flex-1 text-base font-light">••••••</p>
    }
  </p-card>
  <p-card styleClass="p-2 min-w-[200px] h-[100px]">
    <ng-template #header>
      <p class="font-extralight">Entradas</p>
    </ng-template>
    @if (eyes()) {
      <p class="flex-1 text-base font-semibold text-left">
        {{ totalIn() | currency: "BRL" }}
      </p>
    } @else {
      <p class="flex-1 text-base font-light">••••••</p>
    }
  </p-card>
  <p-card styleClass="p-2 min-w-[200px] h-[100px]">
    <ng-template #header>
      <p class="font-extralight">Saídas</p>
    </ng-template>
    @if (eyes()) {
      <p class="flex-1 text-base font-semibold text-left">
        {{ totalExpenses() | currency: "BRL" }}
      </p>
    } @else {
      <p class="flex-1 text-base font-light">••••••</p>
    }
  </p-card>
</div>

<p-table [value]="records" styleClass="my-2">
  <ng-template #header>
    <tr>
      <th class="text-sm">Valor</th>
      <th class="text-sm">Descrição</th>
      <th class="text-sm">Tipo</th>
      <th class="text-sm">Data</th>
      <th class="text-sm">Ações</th>
    </tr>
  </ng-template>
  <ng-template #body let-record>
    <tr>
      <td class="text-sm w-[200px]">
        @if (eyes()) {
          {{ record.amount | currency: "BRL" }}
        } @else {
          ••••••
        }
      </td>
      <td class="text-sm">{{ record.description }}</td>
      <td class="text-sm">
        <p-tag
          rounded="true"
          [value]="isMobile() ? '' : record.tag"
          [icon]="record.icon"
          [severity]="record.transaction == 'IN' ? 'success' : 'danger'"
        ></p-tag>
      </td>
      <td class="text-sm">{{ record.date }}</td>
      <td class="text-sm">
        <div class="flex flex-row gap-1">
          <p-button
            icon="pi pi-pencil"
            [rounded]="true"
            [text]="true"
            severity="warn"
            (click)="showEditDialog(record)"
          />
          <p-button
            icon="pi pi-trash"
            [rounded]="true"
            [text]="true"
            severity="danger"
            (click)="deleteRecord(record.id)"
          />
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-paginator
  (onPageChange)="onPageChange($event)"
  [rows]="rows()"
  [totalRecords]="totalRecords()"
  [rowsPerPageOptions]="[10, 20, 30]"
/>

<p-dialog
  header="Editar Registro"
  [(visible)]="editDialogVisible"
  [modal]="true"
  [style]="{ width: '450px' }"
  draggable="false"
  resizable="false"
>
  <form [formGroup]="editForm" class="flex flex-col gap-4 py-4">
    <div class="flex flex-col gap-2">
      <label for="amount" class="text-sm font-medium">Valor</label>
      <p-inputNumber
        id="amount"
        formControlName="amount"
        mode="currency"
        currency="BRL"
        locale="pt-BR"
        styleClass="w-full"
      />
    </div>

    <div class="flex flex-col gap-2">
      <label for="description" class="text-sm font-medium">Descrição</label>
      <input
        pInputText
        id="description"
        formControlName="description"
        class="w-full"
      />
    </div>

    <div class="flex flex-col gap-2">
      <label for="transaction" class="text-sm font-medium">Tipo</label>
      <p-select
        id="transaction"
        formControlName="transaction"
        [options]="transactions"
        optionLabel="label"
        optionValue="value"
        placeholder="Selecione o tipo"
        styleClass="w-full"
      />
    </div>

    <div class="flex flex-col gap-2">
      <label for="category" class="text-sm font-medium">Categoria</label>
      <p-select
        id="category"
        formControlName="category"
        [options]="categories"
        optionLabel="label"
        optionValue="value"
        placeholder="Selecione a categoria"
        styleClass="w-full"
      />
    </div>

    <div class="flex flex-col gap-2">
      <label for="date" class="text-sm font-medium">Data</label>
      <p-datepicker
        id="date"
        formControlName="date"
        dateFormat="dd/mm/yy"
        [showIcon]="true"
        styleClass="w-full"
      />
    </div>

    <div class="flex flex-row justify-end gap-2 mt-4">
      <p-button
        label="Cancelar"
        [text]="true"
        severity="secondary"
        (click)="editDialogVisible.set(false)"
      />
      <p-button
        label="Salvar"
        (click)="saveEdit()"
        [disabled]="editForm.invalid"
      />
    </div>
  </form>
</p-dialog>
